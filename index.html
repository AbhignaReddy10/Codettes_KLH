<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BiteConnect | AI Supply Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800 p-6 lg:p-12">

<div class="max-w-7xl mx-auto">

<!-- HEADER -->
<div class="flex justify-between items-center mb-10">
    <div>
        <h1 class="text-4xl font-bold">
            BiteConnect <span class="text-emerald-600">AI</span>
        </h1>
        <p class="text-gray-500 mt-1">
            Smart Inventory Forecasting & Redistribution Engine
        </p>
    </div>
    <span class="bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full text-xs font-bold">
        SYSTEM ONLINE
    </span>
</div>

<div class="grid lg:grid-cols-3 gap-8">

<!-- CONTROL PANEL -->
<div class="bg-white rounded-2xl shadow p-6 space-y-6">

<h2 class="text-lg font-bold border-b pb-2">Upload Data</h2>

<div>
<label class="text-xs font-bold text-gray-400 uppercase">Sales CSV</label>
<input type="file" id="salesFile"
class="mt-2 block w-full text-sm file:bg-emerald-50 file:text-emerald-700 file:px-4 file:py-2 file:rounded-full file:border-0">
</div>

<div>
<label class="text-xs font-bold text-gray-400 uppercase">Inventory CSV</label>
<input type="file" id="inventoryFile"
class="mt-2 block w-full text-sm file:bg-emerald-50 file:text-emerald-700 file:px-4 file:py-2 file:rounded-full file:border-0">
</div>

<button onclick="analyzeBiteConnect()"
id="analyzeBtn"
class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold hover:bg-emerald-700 transition">
RUN AI ANALYSIS
</button>

<div id="loadingText" class="hidden text-sm text-emerald-600 font-medium">
Running AI Analysis...
</div>

</div>

<!-- RESULTS -->
<div class="lg:col-span-2 space-y-6">

<!-- KPI CARDS -->
<div class="grid md:grid-cols-3 gap-6">

<div class="bg-white rounded-2xl shadow p-6 border-t-4 border-red-500">
<p class="text-xs uppercase text-gray-400 font-bold">Restock Alerts</p>
<div id="restockCount" class="text-4xl font-bold mt-2">0</div>
</div>

<div class="bg-white rounded-2xl shadow p-6 border-t-4 border-emerald-500">
<p class="text-xs uppercase text-gray-400 font-bold">Surplus Items</p>
<div id="surplusCount" class="text-4xl font-bold mt-2">0</div>
</div>

<div class="bg-white rounded-2xl shadow p-6 border-t-4 border-blue-500">
<p class="text-xs uppercase text-gray-400 font-bold">AI Confidence</p>
<div id="confidenceValue" class="text-4xl font-bold mt-2">0%</div>
</div>

</div>

<!-- INVENTORY TABLE -->
<div class="bg-white rounded-2xl shadow p-6">
<h3 class="font-bold mb-4">Inventory Overview</h3>
<table class="w-full text-sm">
<thead class="bg-gray-50 text-gray-500 uppercase text-xs">
<tr>
<th class="p-3 text-left">Item</th>
<th class="p-3 text-left">Stock</th>
<th class="p-3 text-left">Status</th>
</tr>
</thead>
<tbody id="inventoryTable">
<tr class="border-t">
<td class="p-3">--</td>
<td class="p-3">--</td>
<td class="p-3">--</td>
</tr>
</tbody>
</table>
</div>

<!-- SOCIAL -->
<div class="bg-emerald-50 rounded-2xl shadow p-6 border border-emerald-200">
<h3 class="font-bold text-emerald-900">Surplus Redistribution</h3>
<div class="mt-3 flex justify-between">
<div>
<p class="text-xs text-gray-400 uppercase font-bold">Assigned NGO</p>
<p id="ngoName" class="font-bold">Food Relief Foundation</p>
</div>
<div>
<div id="surplusQty" class="text-3xl font-bold text-emerald-600">0</div>
<p class="text-xs uppercase text-emerald-500 font-bold">Units</p>
</div>
</div>
</div>

<!-- AI INSIGHT -->
<div class="bg-gray-900 text-gray-300 rounded-2xl p-6 text-sm">
<strong>AI Strategic Insight:</strong>
<p id="reasoning" class="mt-3 whitespace-pre-line">
Awaiting analysis...
</p>
</div>

</div>
</div>
</div>

<script>

async function analyzeBiteConnect() {

const btn = document.getElementById("analyzeBtn");
const loading = document.getElementById("loadingText");

btn.disabled = true;
loading.classList.remove("hidden");

const sales = document.getElementById("salesFile").files[0];
const inventory = document.getElementById("inventoryFile").files[0];

if (!sales || !inventory) {
alert("Please upload both CSV files.");
btn.disabled = false;
loading.classList.add("hidden");
return;
}

const formData = new FormData();
formData.append("sales_file", sales);
formData.append("inventory_file", inventory);

try {

const res = await fetch("http://localhost:8000/analyze", {
method: "POST",
body: formData
});

const data = await res.json();

console.log("Backend Response:", data);

// KPI updates
document.getElementById("restockCount").innerText =
data.restock_alerts.length;

document.getElementById("surplusCount").innerText =
data.surplus_items.length;

document.getElementById("confidenceValue").innerText =
data.confidence_score + "%";

// Inventory table update
let tableHTML = "";

data.restock_alerts.forEach(item => {
tableHTML += `
<tr class="border-t">
<td class="p-3">${item.item}</td>
<td class="p-3">${item.current_stock}</td>
<td class="p-3 text-red-600 font-bold">RESTOCK</td>
</tr>`;
});

data.surplus_items.forEach(item => {
tableHTML += `
<tr class="border-t">
<td class="p-3">${item.item}</td>
<td class="p-3">${item.current_stock}</td>
<td class="p-3 text-emerald-600 font-bold">SURPLUS</td>
</tr>`;
});

if (tableHTML === "") {
tableHTML = `
<tr class="border-t">
<td class="p-3">All Items</td>
<td class="p-3">Stable</td>
<td class="p-3 text-emerald-600 font-bold">OK</td>
</tr>`;
}

document.getElementById("inventoryTable").innerHTML = tableHTML;

// Social
let totalSurplus = 0;
data.surplus_items.forEach(item => {
totalSurplus += item.estimated_weekly_need;
});
document.getElementById("surplusQty").innerText = totalSurplus;

// AI reasoning
document.getElementById("reasoning").innerText =
data.ai_plan;

} catch (err) {
alert("Backend not running or CORS issue.");
console.error(err);
}

btn.disabled = false;
loading.classList.add("hidden");
}

</script>

</body>
</html>
